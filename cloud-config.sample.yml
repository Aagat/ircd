#cloud-config

---
hostname: host1
coreos:
  etcd:
    discovery: https://discovery.etcd.io/74dc9ee6baba72a34504cb78db219f13
    addr: $private_ipv4:4001
    peer-addr: $private_ipv4:7001
  fleet:
    public-ip: $private_ipv4
  units:
  - name: etcd.service
    command: start
  - name: fleet.service
    command: start
  - name: docker-unrealircd.service
    command: start
    content: |
      [Unit]
      Description=Somehost IRC Server
      Author=Somehost Team
      After=docker.service

      [Service]
      Restart=always
      ExecStart=/usr/bin/docker run \
        -v /etc/ssl/localcerts:/etc/ssl/localcerts \
        --env-file /application.env \
        -p 6697:6697 \
        -p 7000:7000 \
        --rm \
        --name="ircd" \
        hashbangsh/unrealircd
      ExecStop=/usr/bin/docker stop ircd
write_files:
- path: /application.env
  permissions: 420
  owner: core
  content: |
    NUMERIC=1
    HOSTNAME=host1.irc.domain.com
    LINK1_NAME=host2.irc.domain.com
    LINK1_HOST=host2.irc.domain.com
    LINK1_PASSWORD_CONNECT=SOME_PASS_HERE
    LINK1_PASSWORD_RECEIVE=SOME_PASS_HERE
    SERVICES_HOST=services.irc.domain.com
    SERVICES_PASSWORD_CONNECT=ANOTHER_PASS_HERE
    SERVICES_PASSWORD_RECEIVE=ANOTHER_PASS_HERE
- path: /etc/ssl/localcerts/server.crt
  permissions: 420
  owner: root
  content: |
    -----BEGIN CERTIFICATE-----
    !!! CERT DATA HERE !!!
    -----END CERTIFICATE-----
- path: /etc/ssl/localcerts/server.key
  permissions: 420
  owner: root
  content: |
    -----BEGIN PRIVATE KEY-----
    !!! CERT DATA HERE !!!
    -----END PRIVATE KEY-----
- path: /etc/ssl/localcerts/server-bundle.crt
  permissions: 420
  owner: root
  content: |
    -----BEGIN CERTIFICATE-----
    !!! CERT DATA HERE !!!
    -----END CERTIFICATE-----
    -----BEGIN CERTIFICATE-----
    !!! CERT DATA HERE !!!
    -----END CERTIFICATE-----
    -----BEGIN CERTIFICATE-----
    !!! CERT DATA HERE !!!
    -----END CERTIFICATE-----
